<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Custom Chess Game</title>

  <!-- Chessboard CSS -->
  <link rel="stylesheet" href="https://unpkg.com/chessboardjs@1.0.0/www/css/chessboard.css"/>

  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      display: flex;
      gap: 30px;
    }
    #board {
      width: 500px;
    }
    .controls {
      max-width: 300px;
      flex-grow: 1;
    }
    textarea {
      width: 100%;
      height: 150px;
      font-family: monospace;
    }
    select, button {
      width: 100%;
      margin-bottom: 10px;
    }
    #status {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="board"></div>

  <div class="controls">
    <label for="styleSelect">Choose Piece Style:</label>
    <select id="styleSelect">
      <option value="wikipedia">Wikipedia (default)</option>
      <option value="alpha">Alpha</option>
    </select>

    <label for="moveInput">Enter move (e.g. e2e4 or Nf3):</label>
    <input id="moveInput" type="text" placeholder="Enter move..." />
    <button onclick="submitMove()">Submit Move</button>

    <label for="pgnInput">Paste PGN / Moves:</label>
    <textarea id="pgnInput" rows="5" placeholder="Paste full game PGN here..."></textarea>
    <button onclick="loadPGN()">Load PGN</button>

    <label for="gamePGN">Game so far (PGN):</label>
    <textarea id="gamePGN" rows="10" readonly></textarea>

    <div id="status"></div>
  </div>

  <!-- Game Logic -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

  <!-- Chessboard JS -->
  <script src="https://unpkg.com/chessboardjs@1.0.0/www/js/chessboard.js"></script>

  <script>
    const game = new Chess();
    let board;
    let currentTheme = 'wikipedia';

    function getPieceTheme(theme) {
      return `https://chessboardjs.com/img/chesspieces/${theme}/{piece}.png`;
    }

    function initBoard() {
      board = Chessboard('board', {
        draggable: true,
        position: game.fen(),
        pieceTheme: getPieceTheme(currentTheme),
        onDragStart: onDragStart,
        onDrop: onDrop
      });
    }

    function onDragStart(source, piece) {
      if (game.game_over()) return false;
      if ((game.turn() === 'w' && piece.startsWith('b')) ||
          (game.turn() === 'b' && piece.startsWith('w'))) return false;
    }

    function onDrop(source, target) {
      const move = game.move({ from: source, to: target, promotion: 'q' });
      if (!move) return 'snapback';
      board.position(game.fen());
      updatePGN();
      updateStatus();
    }

    function submitMove() {
      const moveText = document.getElementById('moveInput').value.trim();
      const move = game.move(moveText, { sloppy: true });
      if (move) {
        board.position(game.fen());
        updatePGN();
        updateStatus();
        document.getElementById('moveInput').value = '';
      } else {
        alert("Invalid move: " + moveText);
      }
    }

    function loadPGN() {
      const pgnText = document.getElementById('pgnInput').value;
      const success = game.load_pgn(pgnText, { sloppy: true });
      if (!success) {
        alert("Invalid PGN or move list.");
      } else {
        board.position(game.fen());
        updatePGN();
        updateStatus();
      }
    }

    function updatePGN() {
      document.getElementById('gamePGN').value = game.pgn();
    }

    function updateStatus() {
      let status = '';
      if (game.in_checkmate()) {
        status = 'Checkmate!';
      } else if (game.in_draw()) {
        status = 'Draw!';
      } else if (game.in_check()) {
        status = (game.turn() === 'w' ? 'White' : 'Black') + ' is in check.';
      } else {
        status = (game.turn() === 'w' ? 'White' : 'Black') + "'s turn.";
      }
      document.getElementById('status').textContent = status;
    }

    document.getElementById('styleSelect').addEventListener('change', function () {
      currentTheme = this.value;
      board.destroy();
      initBoard();
    });

    window.onload = () => {
      initBoard();
      updatePGN();
      updateStatus();
    };
  </script>
</body>
</html>
